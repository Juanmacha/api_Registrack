# ğŸ“‹ Solicitud de DocumentaciÃ³n TÃ©cnica - Endpoint POST /api/seguimiento/crear

## ğŸ¯ Contexto

El frontend estÃ¡ integrando el mÃ³dulo de seguimiento siguiendo la documentaciÃ³n proporcionada. El endpoint `GET /api/seguimiento/historial/:idOrdenServicio` funciona correctamente, pero el endpoint `POST /api/seguimiento/crear` estÃ¡ retornando error 500 (Internal Server Error) cuando el frontend envÃ­a el payload.

## âŒ Problema Actual

**Endpoint que falla:** `POST /api/seguimiento/crear`

**Error recibido:**
```json
{
  "mensaje": "Error interno del servidor."
}
```

**Payload que se estÃ¡ enviando desde el frontend:**
```json
{
  "id_orden_servicio": 17,
  "titulo": "Vamonos a marte",
  "descripcion": "A las estrellas",
  "observaciones": "no"
}
```

**Headers enviados:**
```
Content-Type: application/json
Authorization: Bearer <token_vÃ¡lido>
```

**Status Code:** 500 (Internal Server Error)

---

## ğŸ“ InformaciÃ³n Requerida del Backend

### 1. **Estructura Exacta del Payload Esperado**

Necesitamos saber **exactamente** quÃ© campos espera el endpoint `POST /api/seguimiento/crear`:

#### Preguntas especÃ­ficas:
- [ ] Â¿El campo `observaciones` es vÃ¡lido? (La documentaciÃ³n lo marca como opcional)
- [ ] Â¿CuÃ¡l es el tipo de dato esperado para cada campo? (string, number, etc.)
- [ ] Â¿Hay restricciones de longitud para cada campo?
- [ ] Â¿Hay validaciones especiales (regex, formatos, etc.)?
- [ ] Â¿Los nombres de los campos deben ser exactamente como estÃ¡n? (Â¿`id_orden_servicio` o `idOrdenServicio`?)

**Por favor, proporcione:**
```javascript
// Ejemplo de payload MÃNIMO que funciona
{
  "id_orden_servicio": 17,
  "titulo": "...",
  "descripcion": "..."
}

// Ejemplo de payload COMPLETO con todos los campos opcionales
{
  "id_orden_servicio": 17,
  "titulo": "...",
  "descripcion": "...",
  "observaciones": "...",
  "documentos_adjuntos": "...",
  "nuevo_proceso": "..."
}
```

---

### 2. **Campos Requeridos vs Opcionales**

**Tabla detallada necesaria:**

| Campo | Tipo | Requerido | Longitud MÃ¡x | DescripciÃ³n | Ejemplo |
|-------|------|-----------|--------------|-------------|---------|
| `id_orden_servicio` | ? | âœ… SÃ­ | ? | ? | 17 |
| `titulo` | ? | âœ… SÃ­ | ? | ? | "Documentos recibidos" |
| `descripcion` | ? | âœ… SÃ­ | ? | ? | "Se recibiÃ³ toda la documentaciÃ³n" |
| `observaciones` | ? | â“ Opcional | ? | ? | "Nota adicional" |
| `documentos_adjuntos` | ? | â“ Opcional | ? | ? | "url1,url2" o "url1" |
| `nuevo_proceso` | ? | â“ Opcional | ? | ? | "VerificaciÃ³n de Documentos" |

**Preguntas:**
- Â¿El campo `observaciones` estÃ¡ implementado en el backend?
- Si es opcional, Â¿puede ser `null`, `undefined` o simplemente omitirse del payload?
- Â¿El campo `documentos_adjuntos` acepta una sola URL o mÃºltiples URLs separadas por comas?
- Â¿El campo `nuevo_proceso` debe ser el nombre exacto del estado (string) o un ID numÃ©rico?

---

### 3. **Validaciones del Backend**

**InformaciÃ³n requerida:**
- Â¿QuÃ© validaciones se realizan antes de crear el seguimiento?
  - Â¿Se valida que `id_orden_servicio` existe en la base de datos?
  - Â¿Se valida que el usuario autenticado tiene permisos?
  - Â¿Se valida que el estado en `nuevo_proceso` existe y es vÃ¡lido para esa orden?
  - Â¿Hay validaciones de formato o longitud?
  
- **Â¿CuÃ¡l es el orden de las validaciones?**
  - Primero: AutenticaciÃ³n
  - Segundo: Permisos
  - Tercero: Existencia de orden
  - Cuarto: ValidaciÃ³n de campos
  - Quinto: ValidaciÃ³n de estado (si se proporciona `nuevo_proceso`)
  - Sexto: CreaciÃ³n del registro

---

### 4. **Logs del Error EspecÃ­fico**

**Necesitamos los logs del backend cuando se ejecuta el siguiente request:**

```http
POST /api/seguimiento/crear
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_orden_servicio": 17,
  "titulo": "Vamonos a marte",
  "descripcion": "A las estrellas",
  "observaciones": "no"
}
```

**Preguntas:**
- Â¿QuÃ© error exacto aparece en los logs del servidor?
- Â¿En quÃ© lÃ­nea del cÃ³digo falla?
- Â¿QuÃ© validaciÃ³n o operaciÃ³n especÃ­fica causa el 500?
- Â¿Hay un stack trace completo del error?

---

### 5. **Estructura de Respuesta Exitosa**

**Por favor, proporcione un ejemplo REAL de respuesta exitosa:**

```json
{
  "mensaje": "...",
  "seguimiento": {
    "id_seguimiento": ?,
    "id_orden_servicio": ?,
    "titulo": ?,
    "descripcion": ?,
    "observaciones": ?,
    "documentos_adjuntos": ?,
    "fecha_registro": ?,
    "registrado_por": ?,
    "nuevo_estado": ?,
    "estado_anterior": ?,
    "usuario_registro": {
      "nombre": ?,
      "apellido": ?,
      "correo": ?
    },
    "cambio_proceso": {
      "proceso_anterior": ?,
      "nuevo_proceso": ?,
      "fecha_cambio": ?
    }
  }
}
```

**Preguntas:**
- Â¿La respuesta siempre incluye el objeto `seguimiento` completo?
- Â¿Siempre incluye `usuario_registro`?
- Â¿Solo incluye `cambio_proceso` si hubo cambio de estado?

---

### 6. **CÃ³digos de Estado y Errores**

**Tabla de cÃ³digos de estado esperados:**

| CÃ³digo | Escenario | Mensaje de Error |
|--------|-----------|------------------|
| 200/201 | âœ… Seguimiento creado exitosamente | - |
| 400 | âŒ Datos invÃ¡lidos | Â¿Mensaje especÃ­fico? |
| 401 | âŒ No autenticado | "No autorizado" |
| 403 | âŒ Sin permisos | "No tiene permisos" |
| 404 | âŒ Orden no encontrada | "No se encontrÃ³ la orden de servicio" |
| 500 | âŒ Error del servidor | "Error interno del servidor" |

**Preguntas:**
- Â¿QuÃ© condiciones especÃ­ficas causan un 400?
- Â¿QuÃ© condiciones especÃ­ficas causan un 500?
- Â¿El error 500 actual es por un problema de base de datos, validaciÃ³n fallida, o error de cÃ³digo?

---

### 7. **Modelo de Base de Datos**

**InformaciÃ³n requerida sobre la tabla `seguimiento` (o equivalente):**

- Â¿CuÃ¡l es el nombre exacto de la tabla?
- Â¿QuÃ© columnas tiene la tabla?
- Â¿QuÃ© columnas son NOT NULL?
- Â¿QuÃ© columnas tienen valores por defecto?
- Â¿Hay triggers o stored procedures que se ejecuten al insertar?

**Ejemplo de estructura esperada:**
```sql
CREATE TABLE seguimiento (
  id_seguimiento INT PRIMARY KEY,
  id_orden_servicio INT NOT NULL,
  titulo VARCHAR(?) NOT NULL,
  descripcion TEXT NOT NULL,
  observaciones TEXT NULL,  -- Â¿Esta columna existe?
  documentos_adjuntos TEXT NULL,
  fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
  registrado_por INT NOT NULL,
  nuevo_estado VARCHAR(?) NULL,
  estado_anterior VARCHAR(?) NULL,
  FOREIGN KEY (id_orden_servicio) REFERENCES orden_servicio(id),
  FOREIGN KEY (registrado_por) REFERENCES usuarios(id)
);
```

---

### 8. **Casos de Prueba Funcionales**

**Por favor, proporcione 3-5 ejemplos REALES que funcionen en Postman o cURL:**

#### Ejemplo 1: Seguimiento mÃ­nimo (sin campos opcionales)
```bash
curl -X POST http://localhost:3000/api/seguimiento/crear \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "id_orden_servicio": 17,
    "titulo": "Test mÃ­nimo",
    "descripcion": "DescripciÃ³n mÃ­nima"
  }'
```

#### Ejemplo 2: Con observaciones
```bash
curl -X POST http://localhost:3000/api/seguimiento/crear \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "id_orden_servicio": 17,
    "titulo": "Test con observaciones",
    "descripcion": "DescripciÃ³n",
    "observaciones": "Esto es una observaciÃ³n"
  }'
```

#### Ejemplo 3: Con cambio de estado
```bash
curl -X POST http://localhost:3000/api/seguimiento/crear \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "id_orden_servicio": 17,
    "titulo": "Cambio de estado",
    "descripcion": "Avanzando proceso",
    "nuevo_proceso": "VerificaciÃ³n de Documentos"
  }'
```

#### Ejemplo 4: Completo (todos los campos)
```bash
curl -X POST http://localhost:3000/api/seguimiento/crear \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "id_orden_servicio": 17,
    "titulo": "Seguimiento completo",
    "descripcion": "DescripciÃ³n completa",
    "observaciones": "Observaciones adicionales",
    "documentos_adjuntos": "https://ejemplo.com/doc1.pdf,https://ejemplo.com/doc2.pdf",
    "nuevo_proceso": "VerificaciÃ³n de Documentos"
  }'
```

---

### 9. **Middleware y AutenticaciÃ³n**

**Preguntas:**
- Â¿El endpoint requiere algÃºn middleware especial ademÃ¡s de autenticaciÃ³n?
- Â¿Hay rate limiting o validaciones adicionales de headers?
- Â¿El token debe tener permisos especÃ­ficos (admin/empleado) o cualquier token vÃ¡lido funciona?

---

### 10. **Dependencias y Relaciones**

**InformaciÃ³n sobre relaciones:**
- Â¿Se valida que `id_orden_servicio` existe antes de crear el seguimiento?
- Â¿Se actualiza automÃ¡ticamente el estado de la orden si se envÃ­a `nuevo_proceso`?
- Â¿Se crean registros relacionados en otras tablas?
- Â¿Hay algÃºn trigger o hook que se ejecute despuÃ©s de crear el seguimiento?

---

## âœ… Checklist de VerificaciÃ³n

**Antes de responder, por favor confirme:**

- [ ] Â¿El endpoint `POST /api/seguimiento/crear` estÃ¡ implementado y funcionando en el backend?
- [ ] Â¿El campo `observaciones` estÃ¡ implementado en el modelo/schema?
- [ ] Â¿Se puede crear un seguimiento con el payload que envÃ­a el frontend usando Postman/cURL directamente?
- [ ] Â¿Los logs del servidor muestran algÃºn error especÃ­fico cuando se ejecuta el request del frontend?
- [ ] Â¿La base de datos tiene la columna `observaciones` en la tabla de seguimiento?
- [ ] Â¿Hay algÃºn middleware o validaciÃ³n que pueda estar bloqueando el request?

---

## ğŸ” InformaciÃ³n Adicional del Frontend

**Lo que el frontend estÃ¡ haciendo correctamente:**
- âœ… Endpoint `GET /api/seguimiento/historial/:idOrdenServicio` funciona perfectamente
- âœ… Endpoint `GET /api/seguimiento/:idOrdenServicio/estados-disponibles` funciona perfectamente
- âœ… AutenticaciÃ³n con Bearer token funciona para otros endpoints
- âœ… El payload se construye segÃºn la documentaciÃ³n proporcionada

**El Ãºnico endpoint que falla es:**
- âŒ `POST /api/seguimiento/crear` â†’ Error 500

---

## ğŸ“ Contacto

Si necesita mÃ¡s informaciÃ³n sobre el request del frontend o los logs del cliente, podemos proporcionar:
- Logs completos del navegador (Network tab)
- Headers exactos enviados
- Payload exacto en diferentes formatos
- InformaciÃ³n sobre el token de autenticaciÃ³n utilizado

---

**Ãšltima actualizaciÃ³n:** $(date)

**Prioridad:** ğŸ”´ **ALTA** - Bloquea la funcionalidad de seguimiento en producciÃ³n

